<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Изменить пароль</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="login-button-container">
        <a href="/login" class="login-button">Выйти</a>
    </div>
    <h1>Изменить пароль</h1>
    {% if error %}
        <div class="error-message" style="color: red; margin-bottom: 15px;">
            {{ error }}
        </div>
    {% endif %}
    <form method="POST">
        {{ form.hidden_tag() }}

        <div>
            {{ form.name.label }}<br>
            {{ form.name() }}
        </div>

        <div>
            {{ form.username.label }}<br>
            {{ form.username() }}
        </div>

        <div class="form-group">
            {{ form.changedpassword.label }}
            <div style="display: flex; align-items: center; gap: 10px;">
                {{ form.changedpassword(id="passwordField", style="flex-grow: 1;") }}
                <button type="button" id="generateBtn" style="padding: 8px 15px;">Сгенерировать</button>
            </div>
            <div style="margin-top: 10px;">
                <label>
                    Длина:
                    <input type="number" id="passLength" min="6" max="32" value="12" style="width: 50px;">
                </label>
                <label style="margin-left: 15px;">
                    <input type="checkbox" id="includeSpecial"> Спецсимволы
                </label>
            </div>
        </div>

        <div>
            {{ form.submit }}
        </div>
    </form>
    <div>
        <a href="{{ url_for('personal_main')}}">← Назад к списку</a>
    </div>

    <script src="{{ url_for('static', filename='scripts/password-generator.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const generateBtn = document.getElementById('generateBtn');
            const passwordField = document.getElementById('passwordField');
            const passLength = document.getElementById('passLength');
            const customWords = document.getElementById('customWords');

            if (generateBtn && passwordField) {
                generateBtn.addEventListener('click', async function() {
                    try {
                        const length = parseInt(passLength.value) || 12;
                        const password = await passwordGenerator.generatePassword(
                            length,
                            customWords ? customWords.value : ''
                        );
                        passwordField.value = password;
                    } catch (error) {
                        console.error('Ошибка генерации пароля:', error);
                        passwordField.value = 'Ошибка генерации';
                    }
                });
            }
        });
    </script>
</body>
</html>